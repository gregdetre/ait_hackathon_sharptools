flowchart TB

  %% Subgraph: Data Structures
  subgraph DS[Data Structures]
    direction TB
    BD[ðŸ“¦ BasicDiff<br/>â€¢ Deterministic, lossless<br/>â€¢ Stable IDs file hunk line<br/>â€¢ Meta and totals<br/>â€¢ Files â†’ Hunks â†’ Lines<br/>â€¢ Attachments blobs and context slices<br/>â€¢ Hunk contentHash<br/>â€¢ Optional word diff spans]
    RD[ðŸ“¦ RichDiff<br/>â€¢ References BasicDiff by IDs only<br/>â€¢ Summary clusters items relations views trace<br/>â€¢ Items include evidence refs fileId hunkId lineIds<br/>â€¢ No raw patch text<br/>â€¢ Optional Mermaid per cluster]
    BD -->|IDs and evidence refs| RD
  end

  %% Subgraph: Workflow
  subgraph WF[Workflow]
    direction TB
    P[ðŸš€ Diff Visualizer Pipeline<br/>â€¢ Run git diff via CLI
â€¢ Generate basic diff json with diff:json
â€¢ Deterministic enrichment with diff:enrich
â€¢ Heuristic rich diff json with diff:rich
â€¢ Render HTML with diff:html
â€¢ Open rich diff report]
  end

  G[ðŸ—‚ï¸ Git repo] -->|git diff| BD
  P -->|artifacts| OUT[ðŸ“¤ Outputs<br/>â€¢ out/basic-diff.json<br/>â€¢ out/enrichment.json<br/>â€¢ out/rich-diff.json<br/>â€¢ out/rich-diff.html]

  CR[Default context radius 20]:::note
  BD -.-> CR

  %% Styling
  class BD basic;
  class RD rich;
  class P pipeline;
  class OUT output;
  class G source;

  classDef basic fill:#e6f2ff,stroke:#2b7bff,stroke-width:1px,color:#0b2a4a;
  classDef rich fill:#fff4e6,stroke:#ff8c2b,stroke-width:1px,color:#4a2a0b;
  classDef pipeline fill:#e6ffe6,stroke:#2bff7b,stroke-width:1px,color:#0b4a2a;
  classDef output fill:#f0f0f0,stroke:#999,stroke-width:1px,color:#333;
  classDef source fill:#f0e6ff,stroke:#7b2bff,stroke-width:1px,color:#2a0b4a;
  classDef note fill:#fff,stroke:#bbb,stroke-dasharray: 3 3,color:#444;

%% Notes
%% Diff Visualizer â€“ Data Structures and Workflow
%% Sources: docs/reference/DATA_STRUCTURES.md and README.md Quick Start
%% To regenerate SVG:
%% npx mmdc -i docs/diagrams/250920a_diff_visualizer_data_structures_and_workflow.mermaid \
%%   -o docs/diagrams/250920a_diff_visualizer_data_structures_and_workflow.svg \
%%   -w 1400 -H 1600 -s 2 -b transparent -t default


